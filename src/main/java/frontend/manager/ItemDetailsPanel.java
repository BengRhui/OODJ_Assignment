/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package frontend.manager;

import frontend.vendor.*;
import backend.entity.Item;
import backend.file_io.PictureIO;
import frontend.manager.UserOverviewPopUp;
import frontend.pop_up.SystemPopUp;
import java.awt.Cursor;
import javax.swing.ImageIcon;

/**
 *
 * @author limbengrhui
 */
public class ItemDetailsPanel extends javax.swing.JPanel {

    private Item currentItem;
    private boolean includeEditIcon;
    private boolean includeDeleteIcon;
    
    /**
     * Creates new form itemDetailsPanel
     * 
     * @param item The item object to be created
     * @param editable {@code true} if the item can be edit
     * @param deletable {@code true} if the item can be deleted
     */
    public ItemDetailsPanel(Item item, boolean editable, boolean deletable) {
        
        // Initialize the variables
        currentItem = item;
        includeEditIcon = editable;
        includeDeleteIcon = deletable;
        
        // Render GUI components
        initComponents();
        
        // Remove icons based on status
        if (!includeDeleteIcon) remove(deleteIcon);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pictureLabel = new javax.swing.JLabel();
        itemTitle = new javax.swing.JLabel();
        itemDescription = new javax.swing.JLabel();
        deleteIcon = new javax.swing.JLabel();
        itemDescription1 = new javax.swing.JLabel();

        setBackground(new java.awt.Color(255, 255, 255));
        setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 2, true));
        setMaximumSize(new java.awt.Dimension(400, 410));
        setMinimumSize(new java.awt.Dimension(400, 410));
        setPreferredSize(new java.awt.Dimension(400, 410));
        setSize(new java.awt.Dimension(400, 410));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        pictureLabel.setBackground(new java.awt.Color(204, 204, 204));
        pictureLabel.setIcon(new ImageIcon(
            PictureIO.retrieveItemPicture(currentItem).getAbsolutePath()
        ));
        pictureLabel.setOpaque(true);
        add(pictureLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(2, 2, 395, 170));

        itemTitle.setFont(new java.awt.Font("Arial", 1, 24)); // NOI18N
        itemTitle.setText(currentItem.getItemName());
        add(itemTitle, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 200, 340, -1));

        itemDescription.setFont(new java.awt.Font("Arial", 1, 24)); // NOI18N
        itemDescription.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        itemDescription.setText("RM" + String.format("%.2f", currentItem.getPrice()));
        add(itemDescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 330, 220, 50));

        deleteIcon.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        deleteIcon.setIcon(new javax.swing.ImageIcon(getClass().getResource("/asset/system/delete_icon.png"))); // NOI18N
        deleteIcon.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        deleteIcon.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                deleteIconMouseClicked(evt);
            }
        });
        add(deleteIcon, new org.netbeans.lib.awtextra.AbsoluteConstraints(330, 330, 40, 50));

        itemDescription1.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        itemDescription1.setText("<html><div style='text-align: justify;'>" + currentItem.getDescription() + "</div></html>");
        itemDescription1.setVerticalAlignment(javax.swing.SwingConstants.TOP);
        add(itemDescription1, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 240, 340, 70));
    }// </editor-fold>//GEN-END:initComponents

    private void deleteIconMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_deleteIconMouseClicked

        // Show message dialog to confirm delete
        SystemPopUp confirmDelete = new SystemPopUp(
                ItemPanel.currentFrame,
                "Delete Item",
                "Do you wish to delete the item?",
                new String[]{"No", "Yes"}
        );
        confirmDelete.setVisible(true);
        
        // Get the status of confirmation
        int messageStatus = confirmDelete.getStatus();
        
        // If user confirms to delete
        if (messageStatus == 1) {
            
            // Perform deletion
            int deleteStatus = currentItem.deleteItem();
            
            // If deletion is successful
            if (deleteStatus == 1) {
                
                // Refresh the panel
                ItemPanel.updatePanel();
                
                // Inform user that deletion is successful
                SystemPopUp successDeletion = new SystemPopUp(
                    ItemPanel.currentFrame,
                    "Delete Successful",
                    "The item is deleted successfully.",
                    new String[]{"OK"}
                );
                successDeletion.setVisible(true);
                
            } else {
                
                // Deletion failed. Declare a variable to store error message
                String errorMessage;
                
                // Generate error message based on error status
                switch (deleteStatus) {
                    case 0 -> errorMessage = "The item is currently ordered by the other customers.";
                    case -1 -> errorMessage = "Error in deleting item picture.";
                    case -2 -> errorMessage = "Error in removing the item from the item list.";
                    default -> errorMessage = "Error status. Please inspect code.";
                }
                
                // Inform user that the deletion is failed
                SystemPopUp failureDelete = new SystemPopUp(
                    ItemPanel.currentFrame,
                    "Error In Deletion",
                    errorMessage,
                    new String[]{"OK"}
                );
                failureDelete.setVisible(true);
            }
        }
    }//GEN-LAST:event_deleteIconMouseClicked


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel deleteIcon;
    private javax.swing.JLabel itemDescription;
    private javax.swing.JLabel itemDescription1;
    private javax.swing.JLabel itemTitle;
    private javax.swing.JLabel pictureLabel;
    // End of variables declaration//GEN-END:variables
}
