/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package frontend.vendor;

import backend.entity.Item;
import backend.file_io.PictureIO;
import frontend.pop_up.HandleItemPopUp;
import frontend.pop_up.SystemPopUp;
import java.awt.Cursor;
import javax.swing.ImageIcon;

/**
 *
 * @author limbengrhui
 */
public class ItemDetailsPanel extends javax.swing.JPanel {

    private Item currentItem;
    private boolean includeEditIcon;
    private boolean includeDeleteIcon;
    
    /**
     * Creates new form itemDetailsPanel
     * 
     * @param item The item object to be created
     * @param editable {@code true} if the item can be edit
     * @param deletable {@code true} if the item can be deleted
     */
    public ItemDetailsPanel(Item item, boolean editable, boolean deletable) {
        
        // Initialize the variables
        currentItem = item;
        includeEditIcon = editable;
        includeDeleteIcon = deletable;
        
        // Render GUI components
        initComponents();
        
        // Remove icons based on status
        if (!includeEditIcon) remove(editIcon);
        if (!includeDeleteIcon) remove(deleteIcon);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pictureLabel = new javax.swing.JLabel();
        itemTitle = new javax.swing.JLabel();
        itemDescription = new javax.swing.JLabel();
        editIcon = new javax.swing.JLabel();
        deleteIcon = new javax.swing.JLabel();
        itemDescription1 = new javax.swing.JLabel();

        setBackground(new java.awt.Color(255, 255, 255));
        setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 2, true));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        pictureLabel.setBackground(new java.awt.Color(204, 204, 204));
        pictureLabel.setIcon(new ImageIcon(
            PictureIO.retrieveItemPicture(currentItem).getAbsolutePath()
        ));
        pictureLabel.setOpaque(true);
        add(pictureLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(2, 2, 395, 170));

        itemTitle.setFont(new java.awt.Font("Arial", 1, 24)); // NOI18N
        itemTitle.setText(currentItem.getItemName());
        add(itemTitle, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 200, 340, -1));

        itemDescription.setFont(new java.awt.Font("Arial", 1, 24)); // NOI18N
        itemDescription.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        itemDescription.setText("RM" + String.format("%.2f", currentItem.getPrice()));
        add(itemDescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 330, 220, 50));

        editIcon.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        editIcon.setIcon(new javax.swing.ImageIcon(getClass().getResource("/asset/system/edit_icon.jpg"))); // NOI18N
        editIcon.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                editIconMouseClicked(evt);
            }
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                editIconMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                editIconMouseExited(evt);
            }
        });
        add(editIcon, new org.netbeans.lib.awtextra.AbsoluteConstraints(280, 330, 40, 50));

        deleteIcon.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        deleteIcon.setIcon(new javax.swing.ImageIcon(getClass().getResource("/asset/system/delete_icon.png"))); // NOI18N
        deleteIcon.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                deleteIconMouseClicked(evt);
            }
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                deleteIconMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                deleteIconMouseExited(evt);
            }
        });
        add(deleteIcon, new org.netbeans.lib.awtextra.AbsoluteConstraints(330, 330, 40, 50));

        itemDescription1.setFont(new java.awt.Font("Arial", 0, 18)); // NOI18N
        itemDescription1.setText("<html><div style='text-align: justify;'>" + currentItem.getDescription() + "</div></html>");
        itemDescription1.setVerticalAlignment(javax.swing.SwingConstants.TOP);
        add(itemDescription1, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 240, 340, 70));
    }// </editor-fold>//GEN-END:initComponents

    private void editIconMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_editIconMouseEntered

        // Set cursor
        editIcon.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
    }//GEN-LAST:event_editIconMouseEntered

    private void editIconMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_editIconMouseExited

        // Set cursor
        editIcon.setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));
    }//GEN-LAST:event_editIconMouseExited

    private void deleteIconMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_deleteIconMouseEntered

        // Set cursor
        deleteIcon.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
    }//GEN-LAST:event_deleteIconMouseEntered

    private void deleteIconMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_deleteIconMouseExited

        // Set cursor
        deleteIcon.setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));
    }//GEN-LAST:event_deleteIconMouseExited

    private void editIconMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_editIconMouseClicked

        // Call the pop up to modify item
        HandleItemPopUp modifyItemPopUp = new HandleItemPopUp(
                MainPage.currentFrame,
                currentItem,
                HandleItemPopUp.MODIFY_ITEMS
        );
        modifyItemPopUp.setVisible(true);
        modifyItemPopUp.setLocationRelativeTo(MainPage.currentFrame);
        
        // Disable the current frame
        MainPage.currentFrame.setEnabled(false);
    }//GEN-LAST:event_editIconMouseClicked

    private void deleteIconMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_deleteIconMouseClicked

        // Show message dialog to confirm delete
        SystemPopUp confirmDelete = new SystemPopUp(
                MainPage.currentFrame,
                "Delete Item",
                "Do you wish to delete the item?",
                new String[]{"No", "Yes"}
        );
        confirmDelete.setVisible(true);
        int messageStatus = confirmDelete.getStatus();
        if (messageStatus == 1) {
            
            int deleteStatus = currentItem.deleteItem();
            if (deleteStatus == 1) {
                ItemListingPanel.updatePanes();
                SystemPopUp successDeletion = new SystemPopUp(
                    MainPage.currentFrame,
                    "Delete Successful",
                    "The item is deleted successfully.",
                    new String[]{"OK"}
                );
                successDeletion.setVisible(true);
            } else {
                
                String errorMessage;
                switch (deleteStatus) {
                    case 0 -> errorMessage = "The item is currently ordered by the other customers.";
                    case -1 -> errorMessage = "Error in deleting item picture.";
                    case -2 -> errorMessage = "Error in removing the item from the item list.";
                    default -> errorMessage = "Error status. Please inspect code.";
                }
                
                SystemPopUp failureDelete = new SystemPopUp(
                    MainPage.currentFrame,
                    "Error In Deletion",
                    errorMessage,
                    new String[]{"OK"}
                );
                failureDelete.setVisible(true);
            }
        }
        
        
    }//GEN-LAST:event_deleteIconMouseClicked


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel deleteIcon;
    private javax.swing.JLabel editIcon;
    private javax.swing.JLabel itemDescription;
    private javax.swing.JLabel itemDescription1;
    private javax.swing.JLabel itemTitle;
    private javax.swing.JLabel pictureLabel;
    // End of variables declaration//GEN-END:variables
}
